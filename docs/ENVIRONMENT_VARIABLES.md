# Environment Variables Configuration Guide

This guide explains all environment variables needed for deploying AgriLogistic to production.

## üéØ Quick Setup Checklist

- [ ] Neon PostgreSQL connection string
- [ ] Cloudflare R2 credentials (Account ID, Access Key, Secret Key)
- [ ] JWT secret for authentication
- [ ] API endpoint URLs

---

## üì¶ Vercel (Frontend - Next.js)

Set these in **Vercel Dashboard ‚Üí Project Settings ‚Üí Environment Variables**:

### Public Variables (Exposed to Browser)

```bash
# API Endpoints
NEXT_PUBLIC_API_URL="https://agri-api.onrender.com/api/v1"
NEXT_PUBLIC_AI_SERVICE_URL="https://agri-ai.onrender.com"

# R2 Public URL (for public images)
NEXT_PUBLIC_R2_URL="https://agri-products.ACCOUNT_ID.r2.cloudflarestorage.com"

# Feature Flags
NEXT_PUBLIC_ENABLE_ANALYTICS="true"
NEXT_PUBLIC_ENABLE_DEBUG="false"
```

### Server-Side Variables (Secure)

```bash
# Database (for server-side operations)
DATABASE_URL="postgresql://user:password@ep-name-123.eu-central-1.aws.neon.tech/agrilogistic?sslmode=require"

# R2 Credentials (for presigned URLs)
R2_ACCOUNT_ID="your-cloudflare-account-id"
R2_ACCESS_KEY_ID="your-r2-access-key-id"
R2_SECRET_ACCESS_KEY="your-r2-secret-access-key"
```

### Environment-Specific Settings

| Variable | Development | Preview | Production |
|----------|-------------|---------|------------|
| `NEXT_PUBLIC_API_URL` | `http://localhost:3001` | `https://preview-api.onrender.com` | `https://agri-api.onrender.com` |
| `NEXT_PUBLIC_ENABLE_DEBUG` | `true` | `true` | `false` |
| `DATABASE_URL` | Local PostgreSQL | Neon branch | Neon main |

---

## üöÄ Render (Backend - NestJS API)

Set these in **Render Dashboard ‚Üí Service ‚Üí Environment**:

```bash
# Node Environment
NODE_ENV="production"
PORT="3000"

# Database
DATABASE_URL="postgresql://user:password@ep-name-123.eu-central-1.aws.neon.tech/agrilogistic?sslmode=require"
DIRECT_URL="postgresql://user:password@ep-name-123.eu-central-1.aws.neon.tech/agrilogistic?sslmode=require"

# Authentication
JWT_SECRET="<auto-generated-by-render>"
JWT_EXPIRES_IN="7d"
REFRESH_TOKEN_EXPIRES_IN="30d"

# Cloudflare R2
R2_ACCOUNT_ID="your-cloudflare-account-id"
R2_ACCESS_KEY_ID="your-r2-access-key-id"
R2_SECRET_ACCESS_KEY="your-r2-secret-access-key"

# CORS
CORS_ORIGIN="https://agrilogistic.vercel.app"

# Optional: Redis (Upstash free tier)
REDIS_URL="redis://default:password@region.upstash.io:6379"
```

---

## ü§ñ Render (AI Service - Python FastAPI)

Set these in **Render Dashboard ‚Üí AI Service ‚Üí Environment**:

```bash
# Model Configuration
MODEL_PATH="/opt/render/project/src/models"
MAX_IMAGE_SIZE_MB="10"

# Cloudflare R2 (for downloading images)
R2_ACCOUNT_ID="your-cloudflare-account-id"
R2_ACCESS_KEY_ID="your-r2-access-key-id"
R2_SECRET_ACCESS_KEY="your-r2-secret-access-key"

# CORS
CORS_ORIGIN="https://agrilogistic.vercel.app"
```

---

## üîê Security Best Practices

### ‚úÖ DO

- **Use Render's "Generate Value"** for `JWT_SECRET` (cryptographically secure)
- **Set different DATABASE_URL** for preview vs production
- **Rotate secrets** every 90 days
- **Use environment-specific values** (dev/preview/prod)

### ‚ùå DON'T

- **Never use `NEXT_PUBLIC_` for secrets** - it exposes to browser
- **Don't hardcode credentials** in code or vercel.json
- **Don't share the same database** between environments
- **Don't commit `.env.production`** to Git

---

## üß™ Testing Environment Variables

### Local Testing

Create `.env.local` (not committed to Git):

```bash
# Copy from .env.production.example
cp .env.production.example .env.local

# Fill in your test values
DATABASE_URL="postgresql://localhost:5432/agrilogistic"
NEXT_PUBLIC_API_URL="http://localhost:3001"
```

### Verify Variables Are Loaded

```bash
# In Next.js
console.log('API URL:', process.env.NEXT_PUBLIC_API_URL);

# In NestJS
console.log('Database:', process.env.DATABASE_URL ? 'Connected' : 'Missing');
```

---

## üîÑ Migration from Docker

If migrating from local Docker setup:

| Old (Docker) | New (Cloud) |
|--------------|-------------|
| `DB_HOST=localhost` | `DATABASE_URL=postgresql://...neon.tech/...` |
| `DB_PORT=5432` | (included in DATABASE_URL) |
| `MINIO_ENDPOINT=localhost:9000` | `R2_ACCOUNT_ID=...` |
| `API_GATEWAY_URL=http://localhost:3000` | `NEXT_PUBLIC_API_URL=https://agri-api.onrender.com` |

---

## üìö Reference

- [Vercel Environment Variables](https://vercel.com/docs/projects/environment-variables)
- [Render Environment Variables](https://render.com/docs/environment-variables)
- [Neon Connection Strings](https://neon.tech/docs/connect/connect-from-any-app)
- [Cloudflare R2 API Tokens](https://developers.cloudflare.com/r2/api/s3/tokens/)
