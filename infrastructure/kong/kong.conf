# ============================================================
# Kong API Gateway - Configuration
# AgroLogistic 2.0 - Cahier des charges 1.1
# Les variables d'environnement (KONG_*) surchargent ces valeurs.
# ============================================================

# Prefix (répertoire de travail Kong)
prefix = /usr/local/kong

# Logs
log_level = notice
proxy_access_log = /dev/stdout
proxy_error_log = /dev/stderr
admin_access_log = /dev/stdout
admin_error_log = /dev/stderr

# Proxy (point d'entrée client)
proxy_listen = 0.0.0.0:8000, 0.0.0.0:8443 ssl http2

# Admin API (administration - à restreindre en production)
admin_listen = 0.0.0.0:8001

# Status API (Prometheus / health)
status_listen = 0.0.0.0:8100

# Base de données (PostgreSQL)
database = postgres
# pg_host, pg_port, pg_user, pg_password, pg_database : définis via variables d'environnement

# Plugins chargés (jwt, rate-limiting, file-log, cors, etc.)
# Défini via KONG_PLUGINS dans docker-compose si besoin
plugins = bundled,jwt,rate-limiting,cors,file-log,request-transformer,response-transformer,prometheus,key-auth,acl,correlation-id

# Performance
nginx_worker_processes = auto
mem_cache_size = 128m

# Sécurité
trusted_ips = 0.0.0.0/0,::/0
