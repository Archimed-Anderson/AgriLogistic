# Dashboard Admin - Guide de DÃ©marrage Rapide

## ğŸš€ DÃ©marrage

### PrÃ©requis
- Node.js 20+
- Docker Desktop (pour les services backend)
- npm 9+

### Installation

1. **Installer les dÃ©pendances**
```bash
cd AgroDeep
npm install
```

2. **DÃ©marrer les services backend** (optionnel pour dÃ©veloppement frontend)
```bash
# DÃ©marrer Kong + Auth Service + Microservices
cd infrastructure
docker compose --env-file env.kong.local -f docker-compose.kong.yml up -d
cd ../backend/auth-service
docker compose -f docker-compose.auth.yml up -d
```

3. **DÃ©marrer le frontend**
```bash
cd AgroDeep
npm run dev
```

4. **AccÃ©der au dashboard admin**
- URL: `http://localhost:5173/admin`
- Login avec un compte admin (Ã  crÃ©er via auth-service)

## ğŸ“ Structure du Code Admin

```
src/
â”œâ”€â”€ domain/admin/
â”‚   â”œâ”€â”€ permissions.ts              # SystÃ¨me de permissions
â”‚   â””â”€â”€ entities/
â”‚       â”œâ”€â”€ admin-user.entity.ts    # EntitÃ© utilisateur admin
â”‚       â””â”€â”€ audit-log.entity.ts     # EntitÃ© logs d'audit
â”‚
â”œâ”€â”€ router/guards/
â”‚   â”œâ”€â”€ RequirePermission.tsx       # Guard par permission
â”‚   â””â”€â”€ RequireAdminRole.tsx        # Guard par rÃ´le
â”‚
â”œâ”€â”€ app/(admin)/
â”‚   â”œâ”€â”€ layout.tsx                  # Layout admin principal
â”‚   â”œâ”€â”€ page.tsx                    # Redirect vers dashboard
â”‚   â””â”€â”€ dashboard/
â”‚       â””â”€â”€ page.tsx                # Page dashboard
â”‚
â””â”€â”€ presentation/components/admin/
    â””â”€â”€ layout/
        â”œâ”€â”€ AdminSidebar.tsx        # Sidebar navigation
        â””â”€â”€ AdminHeader.tsx         # Header avec search/notifs
```

## ğŸ” SystÃ¨me de Permissions

### RÃ´les Disponibles

- **SUPER_ADMIN** (Niveau 3) : AccÃ¨s complet
- **ADMIN** (Niveau 2) : Gestion complÃ¨te sauf systÃ¨me critique
- **MANAGER** (Niveau 1) : Gestion opÃ©rationnelle
- **SUPPORT** (Niveau 0) : Lecture seule + support client

### Utilisation des Guards

```typescript
// ProtÃ©ger une route par permission
<Route
  path="/admin/users"
  element={
    <RequirePermission permission={AdminPermission.USERS_VIEW}>
      <UsersPage />
    </RequirePermission>
  }
/>

// ProtÃ©ger une route par rÃ´le minimum
<Route
  path="/admin/system"
  element={
    <RequireAdminRole minRole={AdminRole.ADMIN}>
      <SystemPage />
    </RequireAdminRole>
  }
/>
```

### VÃ©rifier les Permissions dans les Composants

```typescript
import { hasPermission, AdminPermission } from '@/domain/admin/permissions';
import { useAuth } from '@/hooks/useAuth';

function MyComponent() {
  const { user } = useAuth();
  
  const canEdit = user?.adminRole && 
    hasPermission(user.adminRole, AdminPermission.USERS_EDIT);
  
  return (
    <div>
      {canEdit && <EditButton />}
    </div>
  );
}
```

## ğŸ¨ Composants UI

### Utiliser le Sidebar

Le sidebar filtre automatiquement les items selon les permissions de l'utilisateur.

```typescript
// Dans AdminSidebar.tsx
const navItems: NavItem[] = [
  {
    label: 'Utilisateurs',
    href: '/admin/users',
    icon: Users,
    permission: AdminPermission.USERS_VIEW, // Optionnel
  },
];
```

### Dark Mode

Le toggle dark mode est dans le header. Il utilise l'attribut `data-theme` sur `<html>`.

```typescript
// Toggle programmatiquement
document.documentElement.setAttribute('data-theme', 'dark');
```

## ğŸ”§ DÃ©veloppement

### Ajouter une Nouvelle Page Admin

1. **CrÃ©er la page**
```bash
# CrÃ©er le fichier
touch src/app/\(admin\)/ma-page/page.tsx
```

2. **ImplÃ©menter le composant**
```typescript
export default function MaPage() {
  return (
    <div>
      <h1>Ma Page Admin</h1>
    </div>
  );
}
```

3. **Ajouter au routing** (si nÃ©cessaire)
```typescript
// Dans AppRoutes.tsx
<Route path="/admin/ma-page" element={<MaPage />} />
```

4. **Ajouter au sidebar** (optionnel)
```typescript
// Dans AdminSidebar.tsx
{
  label: 'Ma Page',
  href: '/admin/ma-page',
  icon: MonIcon,
  permission: AdminPermission.MA_PERMISSION,
}
```

### Ajouter une Nouvelle Permission

1. **Ajouter l'enum**
```typescript
// Dans src/domain/admin/permissions.ts
export enum AdminPermission {
  // ...
  MA_NOUVELLE_PERMISSION = 'module:action',
}
```

2. **Ajouter aux rÃ´les**
```typescript
export const ROLE_PERMISSIONS: Record<AdminRole, AdminPermission[]> = {
  [AdminRole.ADMIN]: [
    // ...
    AdminPermission.MA_NOUVELLE_PERMISSION,
  ],
};
```

## ğŸ§ª Tests

```bash
# Tests unitaires
npm run test

# Tests E2E
npm run test:e2e

# Tests avec couverture
npm run test:coverage
```

## ğŸ“š Documentation ComplÃ¨te

- [Plan d'implÃ©mentation](./brain/implementation_plan.md)
- [Matrice de permissions](./brain/permissions_matrix.md)
- [Architecture des composants](./brain/component_architecture.md)
- [SpÃ©cifications UI](./brain/ui_specifications.md)

## ğŸ› Troubleshooting

### Le dashboard admin ne s'affiche pas

1. VÃ©rifier que l'utilisateur a un rÃ´le admin dans le JWT
2. VÃ©rifier les guards dans la console du navigateur
3. VÃ©rifier que les routes sont bien configurÃ©es

### Les permissions ne fonctionnent pas

1. VÃ©rifier que `user.adminRole` est dÃ©fini
2. VÃ©rifier que la permission existe dans l'enum
3. VÃ©rifier que le rÃ´le a bien la permission dans `ROLE_PERMISSIONS`

### Erreurs TypeScript

```bash
# VÃ©rifier les types
npm run typecheck

# Nettoyer et rÃ©installer
npm run clean
rm -rf node_modules
npm install
```

## ğŸ¤ Contribution

1. CrÃ©er une branche : `git checkout -b feature/ma-feature`
2. DÃ©velopper et tester
3. Valider : `npm run validate:full`
4. Commit : `git commit -m "feat: ma feature"`
5. Push : `git push origin feature/ma-feature`
6. CrÃ©er une Pull Request

---

**Version** : 1.0.0  
**DerniÃ¨re mise Ã  jour** : 2026-01-22
